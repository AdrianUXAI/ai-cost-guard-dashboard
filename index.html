<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cost Guard Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .card { background-color: white; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); padding: 1.5rem; }
        .btn-primary { background-color: #4f46e5; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; }
        .btn-primary:hover { background-color: #4338ca; }
        .btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <header class="mb-8 text-center">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">AI Cost Guard</h1>
        <p class="text-lg text-indigo-600">Secure AI Gateway with Budget Control</p>
    </header>

    <main class="max-w-4xl mx-auto space-y-6">

        <!-- Configuration Card -->
        <div class="card bg-blue-50 border border-blue-200">
            <h2 class="text-xl font-bold text-blue-800 mb-4">1. Configuration</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Supabase Edge Function URL</label>
                    <input id="proxy-url-input" type="text" 
                           placeholder="https://[project-ref].supabase.co/functions/v1/ai-proxy" 
                           class="w-full p-2 border border-gray-300 rounded-lg"
                           value="https://tsogjfhrvzuweshlfrfu.supabase.co/functions/v1/ai-proxy">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Supabase Anon Key (Required for Auth)</label>
                    <input id="anon-key-input" type="password" 
                           placeholder="Paste your 'anon' public key here (starts with eyJ...)" 
                           class="w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
        </div>

        <!-- Test Section -->
        <div class="card">
            <h2 class="text-xl font-bold text-gray-800 mb-4">2. Run AI Test</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Prompt</label>
                <textarea id="prompt-input" rows="2" class="w-full p-2 border border-gray-300 rounded-lg">Explain AI caching.</textarea>
            </div>

            <div class="flex items-center space-x-4">
                <button id="run-test-btn" onclick="runTest()" class="btn-primary">
                    Run Test
                </button>
                <span id="status-indicator" class="text-sm font-semibold text-gray-500">Ready</span>
            </div>

            <!-- Output -->
            <div class="mt-6 bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                <p class="text-gray-400 mb-2">--- Console Output ---</p>
                <pre id="console-output">Waiting for input...</pre>
            </div>
        </div>

    </main>

    <script>
        function log(message, isError = false) {
            const output = document.getElementById('console-output');
            output.textContent = message;
            output.style.color = isError ? '#fca5a5' : '#4ade80'; // Red for error, Green for success
            document.getElementById('status-indicator').textContent = isError ? 'Error' : 'Success';
        }

        async function runTest() {
            const url = document.getElementById('proxy-url-input').value.trim();
            const key = document.getElementById('anon-key-input').value.trim();
            const prompt = document.getElementById('prompt-input').value.trim();

            if (!url) return log("Error: URL is missing.", true);
            if (!key) return log("Error: Anon Key is missing. Please paste it in the box above.", true);

            document.getElementById('run-test-btn').disabled = true;
            document.getElementById('status-indicator').textContent = 'Running...';
            log("Sending request...");

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${key}` // <--- THIS FIXES THE 401 ERROR
                    },
                    body: JSON.stringify({
                        customerId: 'test-user-123',
                        prompt: prompt
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    log(JSON.stringify(data, null, 2));
                } else {
                    log(`Error ${response.status}: ${data.error || data.message || response.statusText}`, true);
                }

            } catch (error) {
                log(`Network Error: ${error.message}. (Check CORS or URL)`, true);
            } finally {
                document.getElementById('run-test-btn').disabled = false;
            }
        }
    </script>
</body>
</html>
